<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Chicago Voter Guide</title>


  <script type="text/javascript" src="http://media.apps.chicagotribune.com/ward-redistricting-2012/new_wards.json"></script>
  <script type="text/javascript" src="http://api.tiles.mapbox.com/mapbox.js/plugins/turf/v1.3.0/turf.min.js"></script>
  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=tru"></script>

  <style type="text/css">
    body {
      font-family: Helvetica;
      margin: 0 auto;
      width: 80%;
      text-align: center;
    }
    input {
      width: 400px;
    }
    #map_canvas {
      width: 500px;
      height: 500px;
      margin: 20px auto;
    }
  </style>

  <script type="text/javascript">

    var geocoder = new google.maps.Geocoder();

    function ward(lat, lng) {
        var point = {
            "type": "Feature",
                "geometry": {
                "type": "Point",
                    "coordinates": [lng, lat]
            }
        };
        for (var i in NEW_WARDS) {
            var the_ward = {
                "type": "Feature",
                    "geometry": {
                    "type": "Polygon",
                        "coordinates": NEW_WARDS[i].simple_shape[0]
                }
            };
            if (turf.inside(point, the_ward)) {
                map_label.innerText = "Ward #" + i;
                mapIt(the_ward, NEW_WARDS[i].centroid, [lng, lat]);
                return NEW_WARDS[i];
            }
        }
        new_map([lng, lat]);
        map_label.innerText = "Not in Chicago :|";
    }

    function new_map(center) {
        var map = new google.maps.Map(map_canvas, {
            zoom: 13,
            center: new google.maps.LatLng(center[1], center[0]),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        return map;
    }

    function mapIt(ward, center, home) {
        var map = new_map(center);
        map.data.addGeoJson(ward);
        map.data.setStyle({
            "strokeWeight": 1,
                "color": "red",
                "fillColor": "red",
                "fillOpacity": 0.1,
                "strokeColor": "red"
        });
        new google.maps.Marker({
            position: new google.maps.LatLng(home[1], home[0]),
            map: map,
            title: 'Hello World!'
        });
        return map;
    }


    function searchSubmit(form) {
        map_label.innerText = "";
        map_canvas.innerHTML = "";

        var address = form.address.value;
        geocoder.geocode({
            address: address
        }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                var parse = results[0].geometry.location.toString().replace(/\(|\)/g, '')
                lat = parse.split(',')[0],
                    lng = parse.split(',')[1];
                ward(lat, lng);
            }
        });
        return false;
    }


  </script>
</head>

<body>
  <h2>Enter Your Address</h2>

  <form onsubmit="return searchSubmit(this);">
    <input type="text" name="address">
    <button type="submit">Check</button>
  </form>

  <div id="map_canvas"></div>

  <h1 id="map_label"></h1>

</body>
</html>
